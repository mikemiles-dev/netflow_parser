#!/bin/bash
# Git pre-commit hook to check README sync
# Install this hook by running: ./scripts/install-hooks.sh

set -e

RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "ðŸ” Pre-commit: Checking README sync..."

# Check if README.md or src/lib.rs are being committed
if git diff --cached --name-only | grep -qE "^(README.md|src/lib.rs)$"; then
    echo "ðŸ“ Documentation files modified, running sync check..."

    # Run doc tests (quick check)
    if ! cargo test --doc --quiet 2>&1 | grep -q "test result: ok"; then
        echo -e "${RED}âœ— Doc tests failed!${NC}"
        echo "  Fix the doc tests before committing."
        echo "  Run: cargo test --doc"
        exit 1
    fi

    echo "âœ“ Doc tests passed"

    # Remind about manual sync
    if git diff --cached --name-only | grep -q "^src/lib.rs$"; then
        echo -e "${YELLOW}âš  src/lib.rs modified${NC}"
        echo "  Don't forget to update README.md if documentation changed!"
    fi

    if git diff --cached --name-only | grep -q "^README.md$"; then
        echo -e "${YELLOW}âš  README.md modified${NC}"
        echo "  Consider updating src/lib.rs doc comments to match!"
    fi
fi

echo "âœ“ Pre-commit checks passed"
exit 0
