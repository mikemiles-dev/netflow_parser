//! See: <https://www.ibm.com/docs/en/npi/1.3.0?topic=versions-v9-field-type-definitions>

use super::data_number::*;

use nom_derive::*;
use serde::Serialize;

#[repr(u16)]
#[derive(Default, Debug, PartialEq, Eq, Clone, Copy, Serialize, Nom)]
pub enum ScopeFieldType {
    System = 1,
    Interface = 2,
    LineCard = 3,
    NetflowCache = 4,
    Template = 5,
    #[default]
    Unknown,
}

impl From<u16> for ScopeFieldType {
    fn from(item: u16) -> Self {
        match item {
            1 => ScopeFieldType::System,
            2 => ScopeFieldType::Interface,
            3 => ScopeFieldType::LineCard,
            4 => ScopeFieldType::NetflowCache,
            5 => ScopeFieldType::Template,
            _ => ScopeFieldType::Unknown,
        }
    }
}

#[repr(u16)]
#[derive(Debug, Hash, PartialEq, Eq, Clone, Ord, PartialOrd, Copy, Serialize, Nom)]
pub enum V9Field {
    InBytes = 1,
    InPkts = 2,
    Flows = 3,
    Protocol = 4,
    SrcTos = 5,
    TcpFlags = 6,
    L4SrcPort = 7,
    Ipv4SrcAddr = 8,
    SrcMask = 9,
    InputSnmp = 10,
    L4DstPort = 11,
    Ipv4DstAddr = 12,
    DstMask = 13,
    OutputSnmp = 14,
    Ipv4NextHop = 15,
    SrcAs = 16,
    DstAs = 17,
    BgpIpv4NextHop = 18,
    MulDstPkts = 19,
    MulDstBytes = 20,
    LastSwitched = 21,
    FirstSwitched = 22,
    OutBytes = 23,
    OutPkts = 24,
    MinPktLngth = 25,
    MaxPktLngth = 26,
    Ipv6SrcAddr = 27,
    Ipv6DstAddr = 28,
    Ipv6SrcMask = 29,
    Ipv6DstMask = 30,
    Ipv6FlowLabel = 31,
    IcmpType = 32,
    MulIgmpType = 33,
    SamplingInterval = 34,
    SamplingAlgorithm = 35,
    FlowActiveTimeout = 36,
    FlowInactiveTimeout = 37,
    EngineType = 38,
    EngineId = 39,
    TotalBytesExp = 40,
    TotalPktsExp = 41,
    TotalFlowsExp = 42,
    Ipv4SrcPrefix = 44,
    Ipv4DstPrefix = 45,
    MplsTopLabelType = 46,
    MplsTopLabelIpAddr = 47,
    FlowSamplerId = 48,
    FlowSamplerMode = 49,
    FlowSamplerRandomInterval = 50,
    MinTtl = 52,
    MaxTtl = 53,
    Ipv4Ident = 54,
    DstTos = 55,
    InSrcMac = 56,
    OutDstMac = 57,
    SrcVlan = 58,
    DstVlan = 59,
    IpProtocolVersion = 60,
    Direction = 61,
    Ipv6NextHop = 62,
    BpgIpv6NextHop = 63,
    Ipv6OptionHeaders = 64,
    MplsLabel1 = 70,
    MplsLabel2 = 71,
    MplsLabel3 = 72,
    MplsLabel4 = 73,
    MplsLabel5 = 74,
    MplsLabel6 = 75,
    MplsLabel7 = 76,
    MplsLabel8 = 77,
    MplsLabel9 = 78,
    MplsLabel10 = 79,
    InDstMac = 80,
    OutSrcMac = 81,
    IfName = 82,
    IfDesc = 83,
    SamplerName = 84,
    InPermanentBytes = 85,
    InPermanentPkts = 86,
    FragmentOffset = 88,
    ForwardingStatus = 89,
    MplsPalRd = 90,
    MplsPrefixLen = 91,
    SrcTrafficIndex = 92,
    DstTrafficIndex = 93,
    ApplicationDescription = 94,
    ApplicationTag = 95,
    ApplicationName = 96,
    PostipDiffServCodePoint = 98,
    Replicationfactor = 99,
    Deprecated = 100,
    Layer2packetSectionOffset = 102,
    Layer2packetSectionSize = 103,
    Layer2packetSectionData = 104,
    FlowStartMilliseconds = 152,
    FlowEndMilliseconds = 153,
    IcmpTypeValue = 176,
    IcmpCodeValue = 177,
    IcmpIpv6TypeValue = 178,
    ImpIpv6CodeValue = 179,
    PostNATSourceIPv4Address = 225,
    PostNATDestinationIPv4Address = 226,
    PostNATTSourceTransportPort = 227,
    PostNATTDestinationTransportPort = 228,
    NatEvent = 230,
    PostNATSourceIpv6Address = 281,
    PostNATDestinationIpv6Address = 282,
    ObservationTimeMilliseconds = 323,
    Vendor,
    Unknown,
}

impl From<V9Field> for FieldDataType {
    fn from(d: V9Field) -> FieldDataType {
        match d {
            V9Field::InBytes => FieldDataType::UnsignedDataNumber,
            V9Field::InPkts => FieldDataType::UnsignedDataNumber,
            V9Field::Flows => FieldDataType::UnsignedDataNumber,
            V9Field::Protocol => FieldDataType::ProtocolType,
            V9Field::SrcTos => FieldDataType::UnsignedDataNumber,
            V9Field::TcpFlags => FieldDataType::UnsignedDataNumber,
            V9Field::L4SrcPort => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv4SrcAddr => FieldDataType::Ip4Addr,
            V9Field::SrcMask => FieldDataType::UnsignedDataNumber,
            V9Field::InputSnmp => FieldDataType::UnsignedDataNumber,
            V9Field::L4DstPort => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv4DstAddr => FieldDataType::Ip4Addr,
            V9Field::DstMask => FieldDataType::UnsignedDataNumber,
            V9Field::OutputSnmp => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv4NextHop => FieldDataType::Ip4Addr,
            V9Field::SrcAs => FieldDataType::UnsignedDataNumber,
            V9Field::DstAs => FieldDataType::UnsignedDataNumber,
            V9Field::BgpIpv4NextHop => FieldDataType::Ip4Addr,
            V9Field::MulDstPkts => FieldDataType::UnsignedDataNumber,
            V9Field::MulDstBytes => FieldDataType::UnsignedDataNumber,
            V9Field::LastSwitched => FieldDataType::DurationMillis,
            V9Field::FirstSwitched => FieldDataType::DurationMillis,
            V9Field::OutBytes => FieldDataType::UnsignedDataNumber,
            V9Field::OutPkts => FieldDataType::UnsignedDataNumber,
            V9Field::MinPktLngth => FieldDataType::UnsignedDataNumber,
            V9Field::MaxPktLngth => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv6SrcAddr => FieldDataType::Ip6Addr,
            V9Field::Ipv6DstAddr => FieldDataType::Ip6Addr,
            V9Field::Ipv6SrcMask => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv6DstMask => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv6FlowLabel => FieldDataType::UnsignedDataNumber,
            V9Field::IcmpType => FieldDataType::UnsignedDataNumber,
            V9Field::MulIgmpType => FieldDataType::UnsignedDataNumber,
            V9Field::SamplingInterval => FieldDataType::UnsignedDataNumber,
            V9Field::SamplingAlgorithm => FieldDataType::UnsignedDataNumber,
            V9Field::FlowActiveTimeout => FieldDataType::UnsignedDataNumber,
            V9Field::FlowInactiveTimeout => FieldDataType::UnsignedDataNumber,
            V9Field::EngineType => FieldDataType::UnsignedDataNumber,
            V9Field::EngineId => FieldDataType::UnsignedDataNumber,
            V9Field::TotalBytesExp => FieldDataType::UnsignedDataNumber,
            V9Field::TotalPktsExp => FieldDataType::UnsignedDataNumber,
            V9Field::TotalFlowsExp => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv4SrcPrefix => FieldDataType::Ip4Addr,
            V9Field::Ipv4DstPrefix => FieldDataType::Ip4Addr,
            V9Field::MplsTopLabelType => FieldDataType::UnsignedDataNumber,
            V9Field::MplsTopLabelIpAddr => FieldDataType::Ip4Addr,
            V9Field::FlowSamplerId => FieldDataType::UnsignedDataNumber,
            V9Field::FlowSamplerMode => FieldDataType::UnsignedDataNumber,
            V9Field::FlowSamplerRandomInterval => FieldDataType::UnsignedDataNumber,
            V9Field::MinTtl => FieldDataType::UnsignedDataNumber,
            V9Field::MaxTtl => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv4Ident => FieldDataType::UnsignedDataNumber,
            V9Field::DstTos => FieldDataType::UnsignedDataNumber,
            V9Field::InSrcMac => FieldDataType::MacAddr,
            V9Field::OutDstMac => FieldDataType::MacAddr,
            V9Field::SrcVlan => FieldDataType::UnsignedDataNumber,
            V9Field::DstVlan => FieldDataType::UnsignedDataNumber,
            V9Field::IpProtocolVersion => FieldDataType::UnsignedDataNumber,
            V9Field::Direction => FieldDataType::UnsignedDataNumber,
            V9Field::Ipv6NextHop => FieldDataType::Ip6Addr,
            V9Field::BpgIpv6NextHop => FieldDataType::Ip6Addr,
            V9Field::Ipv6OptionHeaders => FieldDataType::UnsignedDataNumber,
            V9Field::MplsLabel1
            | V9Field::MplsLabel2
            | V9Field::MplsLabel3
            | V9Field::MplsLabel4
            | V9Field::MplsLabel5
            | V9Field::MplsLabel6
            | V9Field::MplsLabel7
            | V9Field::MplsLabel8
            | V9Field::MplsLabel9
            | V9Field::MplsLabel10 => FieldDataType::UnsignedDataNumber,
            V9Field::InDstMac => FieldDataType::MacAddr,
            V9Field::OutSrcMac => FieldDataType::MacAddr,
            V9Field::IfName => FieldDataType::UnsignedDataNumber,
            V9Field::IfDesc => FieldDataType::UnsignedDataNumber,
            V9Field::SamplerName => FieldDataType::UnsignedDataNumber,
            V9Field::InPermanentBytes => FieldDataType::UnsignedDataNumber,
            V9Field::InPermanentPkts => FieldDataType::UnsignedDataNumber,
            V9Field::FragmentOffset => FieldDataType::UnsignedDataNumber,
            V9Field::ForwardingStatus => FieldDataType::UnsignedDataNumber,
            V9Field::MplsPalRd => FieldDataType::Vec,
            V9Field::MplsPrefixLen => FieldDataType::UnsignedDataNumber,
            V9Field::SrcTrafficIndex => FieldDataType::UnsignedDataNumber,
            V9Field::DstTrafficIndex => FieldDataType::UnsignedDataNumber,
            V9Field::ApplicationDescription => FieldDataType::String,
            V9Field::ApplicationTag => FieldDataType::Vec,
            V9Field::ApplicationName => FieldDataType::String,
            V9Field::PostipDiffServCodePoint => FieldDataType::UnsignedDataNumber,
            V9Field::Replicationfactor => FieldDataType::UnsignedDataNumber,
            V9Field::Deprecated => FieldDataType::UnsignedDataNumber,
            V9Field::Layer2packetSectionOffset => FieldDataType::UnsignedDataNumber,
            V9Field::Layer2packetSectionSize => FieldDataType::UnsignedDataNumber,
            V9Field::Layer2packetSectionData => FieldDataType::UnsignedDataNumber,
            V9Field::FlowStartMilliseconds => FieldDataType::DurationMillis,
            V9Field::FlowEndMilliseconds => FieldDataType::DurationMillis,
            V9Field::IcmpTypeValue => FieldDataType::UnsignedDataNumber,
            V9Field::IcmpCodeValue => FieldDataType::UnsignedDataNumber,
            V9Field::IcmpIpv6TypeValue => FieldDataType::UnsignedDataNumber,
            V9Field::ImpIpv6CodeValue => FieldDataType::UnsignedDataNumber,
            V9Field::PostNATSourceIPv4Address => FieldDataType::Ip4Addr,
            V9Field::PostNATDestinationIPv4Address => FieldDataType::Ip4Addr,
            V9Field::PostNATTSourceTransportPort => FieldDataType::UnsignedDataNumber,
            V9Field::PostNATTDestinationTransportPort => FieldDataType::UnsignedDataNumber,
            V9Field::PostNATSourceIpv6Address => FieldDataType::Ip6Addr,
            V9Field::PostNATDestinationIpv6Address => FieldDataType::Ip6Addr,
            V9Field::ObservationTimeMilliseconds => FieldDataType::DurationMillis,
            V9Field::NatEvent => FieldDataType::UnsignedDataNumber,
            _ => FieldDataType::Unknown,
        }
    }
}

impl From<u16> for V9Field {
    fn from(item: u16) -> Self {
        match item {
            1 => V9Field::InBytes,
            2 => V9Field::InPkts,
            3 => V9Field::Flows,
            4 => V9Field::Protocol,
            5 => V9Field::SrcTos,
            6 => V9Field::TcpFlags,
            7 => V9Field::L4SrcPort,
            8 => V9Field::Ipv4SrcAddr,
            9 => V9Field::SrcMask,
            10 => V9Field::InputSnmp,
            11 => V9Field::L4DstPort,
            12 => V9Field::Ipv4DstAddr,
            13 => V9Field::DstMask,
            14 => V9Field::OutputSnmp,
            15 => V9Field::Ipv4NextHop,
            16 => V9Field::SrcAs,
            17 => V9Field::DstAs,
            18 => V9Field::BgpIpv4NextHop,
            19 => V9Field::MulDstPkts,
            20 => V9Field::MulDstBytes,
            21 => V9Field::LastSwitched,
            22 => V9Field::FirstSwitched,
            23 => V9Field::OutBytes,
            24 => V9Field::OutPkts,
            25 => V9Field::MinPktLngth,
            26 => V9Field::MaxPktLngth,
            27 => V9Field::Ipv6SrcAddr,
            28 => V9Field::Ipv6DstAddr,
            29 => V9Field::Ipv6SrcMask,
            30 => V9Field::Ipv6DstMask,
            31 => V9Field::Ipv6FlowLabel,
            32 => V9Field::IcmpType,
            33 => V9Field::MulIgmpType,
            34 => V9Field::SamplingInterval,
            35 => V9Field::SamplingAlgorithm,
            36 => V9Field::FlowActiveTimeout,
            37 => V9Field::FlowInactiveTimeout,
            38 => V9Field::EngineType,
            39 => V9Field::EngineId,
            40 => V9Field::TotalBytesExp,
            41 => V9Field::TotalPktsExp,
            42 => V9Field::TotalFlowsExp,
            43 => V9Field::Vendor,
            44 => V9Field::Ipv4SrcPrefix,
            45 => V9Field::Ipv4DstPrefix,
            46 => V9Field::MplsTopLabelType,
            47 => V9Field::MplsTopLabelIpAddr,
            48 => V9Field::FlowSamplerId,
            49 => V9Field::FlowSamplerMode,
            50 => V9Field::FlowSamplerRandomInterval,
            51 => V9Field::Vendor,
            52 => V9Field::MinTtl,
            53 => V9Field::MaxTtl,
            54 => V9Field::Ipv4Ident,
            55 => V9Field::DstTos,
            56 => V9Field::InSrcMac,
            57 => V9Field::OutDstMac,
            58 => V9Field::SrcVlan,
            59 => V9Field::DstVlan,
            60 => V9Field::IpProtocolVersion,
            61 => V9Field::Direction,
            62 => V9Field::Ipv6NextHop,
            63 => V9Field::BpgIpv6NextHop,
            64 => V9Field::Ipv6OptionHeaders,
            65 => V9Field::Vendor,
            66 => V9Field::Vendor,
            67 => V9Field::Vendor,
            68 => V9Field::Vendor,
            69 => V9Field::Vendor,
            70 => V9Field::MplsLabel1,
            71 => V9Field::MplsLabel2,
            72 => V9Field::MplsLabel3,
            73 => V9Field::MplsLabel4,
            74 => V9Field::MplsLabel5,
            75 => V9Field::MplsLabel6,
            76 => V9Field::MplsLabel7,
            77 => V9Field::MplsLabel8,
            78 => V9Field::MplsLabel9,
            79 => V9Field::MplsLabel10,
            80 => V9Field::InDstMac,
            81 => V9Field::OutSrcMac,
            82 => V9Field::IfName,
            83 => V9Field::IfDesc,
            84 => V9Field::SamplerName,
            85 => V9Field::InPermanentBytes,
            86 => V9Field::InPermanentPkts,
            87 => V9Field::Vendor,
            88 => V9Field::FragmentOffset,
            89 => V9Field::ForwardingStatus,
            90 => V9Field::MplsPalRd,
            91 => V9Field::MplsPrefixLen,
            92 => V9Field::SrcTrafficIndex,
            93 => V9Field::DstTrafficIndex,
            94 => V9Field::ApplicationDescription,
            95 => V9Field::ApplicationTag,
            96 => V9Field::ApplicationName,
            98 => V9Field::PostipDiffServCodePoint,
            99 => V9Field::Replicationfactor,
            100 => V9Field::Deprecated,
            102 => V9Field::Layer2packetSectionOffset,
            103 => V9Field::Layer2packetSectionSize,
            104 => V9Field::Layer2packetSectionData,
            152 => V9Field::FlowStartMilliseconds,
            153 => V9Field::FlowEndMilliseconds,
            176 => V9Field::IcmpTypeValue,
            177 => V9Field::IcmpCodeValue,
            178 => V9Field::IcmpIpv6TypeValue,
            179 => V9Field::ImpIpv6CodeValue,
            225 => V9Field::PostNATSourceIPv4Address,
            226 => V9Field::PostNATDestinationIPv4Address,
            227 => V9Field::PostNATTSourceTransportPort,
            228 => V9Field::PostNATTDestinationTransportPort,
            230 => V9Field::NatEvent,
            281 => V9Field::PostNATSourceIpv6Address,
            282 => V9Field::PostNATDestinationIpv6Address,
            323 => V9Field::ObservationTimeMilliseconds,
            _ => V9Field::Unknown,
        }
    }
}

#[cfg(test)]
mod v9_lookup_tests {

    use crate::variable_versions::data_number::FieldDataType;

    use super::V9Field;

    use insta::assert_yaml_snapshot;

    #[test]
    fn it_tests_field_lookup() {
        let mut fields = vec![];
        for i in 1..=282 {
            let field: V9Field = i.into();
            fields.push(field);
        }
        assert_yaml_snapshot!(fields);
    }

    #[test]
    fn it_tests_field_data_type_lookup() {
        let mut fields: Vec<FieldDataType> = vec![];
        for i in 1..=282 {
            let field: V9Field = i.into();
            fields.push(field.into());
        }
        assert_yaml_snapshot!(fields);
    }
}
